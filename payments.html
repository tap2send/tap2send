<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tap2Send | Payment</title>
<style>
body{margin:0;font-family:sans-serif;background:#0C7A43;color:white;}
header{background:#1E3A8A;padding:20px;text-align:center;}
header h1{color:#D4AF37;margin:0;}
nav{display:flex;justify-content:center;gap:20px;margin-top:10px;}
nav a{text-decoration:none;color:#fff;font-weight:bold;}
nav a:hover{color:#D4AF37;}
section{padding:50px 20px;text-align:center;}
.payment-box{background:#1E3A8A;padding:30px;border-radius:15px;margin:30px auto;max-width:400px;}
input,button{width:100%;padding:12px;margin:10px 0;border-radius:10px;border:none;}
button{background:#D4AF37;color:black;font-weight:bold;cursor:pointer;}
button:hover{opacity:0.9;}
</style>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "YOUR_FIREBASE_KEY",
  authDomain: "YOUR_FIREBASE_DOMAIN",
  projectId: "YOUR_FIREBASE_PROJECT_ID",
  storageBucket: "YOUR_FIREBASE_BUCKET",
  messagingSenderId: "YOUR_FIREBASE_SENDER",
  appId: "YOUR_FIREBASE_APPID"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Parse plan from URL
const urlParams = new URLSearchParams(window.location.search);
const selectedPlan = urlParams.get('plan');

function payNow(){
  auth.onAuthStateChanged(user=>{
    if(user){
      const uid = user.uid;
      const txnId = 'TXN'+Math.floor(Math.random()*1000000); // Simulated txn ID

      // Store payment request in Firebase
      db.collection('payments').doc(txnId).set({
        uid: uid,
        plan: selectedPlan,
        amount: planAmount(selectedPlan),
        status: 'Pending',
        createdAt: new Date()
      }).then(()=>{
        alert(`Payment request generated. Pay via UPI: 9019254743@xyl \nTxn ID: ${txnId}\nAfter payment, admin will approve.`)
      });
    } else {
      alert("Please login first!");
      window.location.href='auth.html';
    }
  });
}

function planAmount(plan){
  switch(plan){
    case 'Pro249': return 249;
    case 'Premium699': return 699;
    case 'Enterprise1299': return 1299;
    default: return 0;
  }
}

// Simulate admin approval check
function checkApproval(){
  auth.onAuthStateChanged(user=>{
    if(user){
      const uid = user.uid;
      db.collection('payments').where('uid','==',uid).where('status','==','Approved').get()
      .then(snap=>{
        if(!snap.empty){
          // Update user's plan & redirect to dashboard
          snap.forEach(doc=>{
            const plan = doc.data().plan;
            let msgs = plan === 'Pro249'? 249 : plan === 'Premium699'? 699 : 1299;
            db.collection('users').doc(uid).set({plan:plan,msgs:msgs},{merge:true})
            .then(()=> window.location.href='dashboard.html');
          });
        } else {
          document.getElementById('status').innerText="Payment not approved yet. Please wait for admin approval.";
        }
      });
    }
  });
}

// Check every 10 seconds
setInterval(checkApproval,10000);

</script>
</head>
<body>

<header>
  <h1>Tap2Send Payment</h1>
  <nav>
    <a href="index.html">Home</a>
    <a href="pricing.html">Pricing</a>
    <a href="about.html">About</a>
    <a href="contact.html">Contact</a>
    <a href="auth.html">Login</a>
  </nav>
</header>

<section>
  <div class="payment-box">
    <h2>Plan Selected: <span id="planName"></span></h2>
    <p>Pay using UPI ID: <strong>9019254743@xyl</strong></p>
    <p>Amount: â‚¹<span id="planAmount"></span></p>
    <button onclick="payNow()">Pay Now</button>
    <p id="status" style="margin-top:15px;color:#D4AF37;"></p>
  </div>
</section>

<script>
document.getElementById('planName').innerText = selectedPlan;
document.getElementById('planAmount').innerText = planAmount(selectedPlan);
</script>

<footer style="background:#0C7A43;padding:20px;text-align:center;">
  <p>&copy; 2025 Tap2Send. All rights reserved.</p>
</footer>

</body>
</html>
