<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tap2Send - WhatsApp Business Integration</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>
    <style>
        :root {
            --madina-green: #0C7A43;
            --golden: #D4AF37;
            --blue: #1E3A8A;
            --white: #FFFFFF;
            --light-green: #E8F5E8;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #0C7A43;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .slide-in {
            animation: slideIn 0.6s ease-out;
        }
        
        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-30px); }
            to { opacity: 1; transform: translateX(0); }
        }
        
        .pulse-glow {
            animation: pulseGlow 2s infinite;
        }
        
        @keyframes pulseGlow {
            0% { box-shadow: 0 0 0 0 rgba(12, 122, 67, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(12, 122, 67, 0); }
            100% { box-shadow: 0 0 0 0 rgba(12, 122, 67, 0); }
        }
        
        .bounce-in {
            animation: bounceIn 0.8s ease-out;
        }
        
        @keyframes bounceIn {
            0% { opacity: 0; transform: scale(0.3); }
            50% { opacity: 1; transform: scale(1.05); }
            70% { transform: scale(0.9); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        .progress-bar {
            height: 4px;
            background: linear-gradient(90deg, #0C7A43, #D4AF37);
            animation: progress 2s ease-in-out infinite;
        }
        
        @keyframes progress {
            0% { width: 0%; }
            50% { width: 70%; }
            100% { width: 100%; }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- Navigation -->
    <nav class="bg-white shadow-lg sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center">
                    <div class="text-2xl font-bold text-[#0C7A43] flex items-center">
                        <span class="bg-[#0C7A43] text-white p-1 rounded mr-2">T2S</span>
                        Tap2Send
                    </div>
                    <div class="hidden md:flex ml-10 space-x-8">
                        <a href="dashboard.html" class="text-gray-700 hover:text-[#0C7A43] transition-colors duration-300">Dashboard</a>
                        <a href="#" class="text-[#0C7A43] font-semibold border-b-2 border-[#0C7A43]">Connect WhatsApp</a>
                        <a href="campaigns.html" class="text-gray-700 hover:text-[#0C7A43] transition-colors duration-300">Campaigns</a>
                        <a href="templates.html" class="text-gray-700 hover:text-[#0C7A43] transition-colors duration-300">Templates</a>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span id="userEmail" class="text-gray-600 hidden md:block text-sm"></span>
                    <button onclick="logout()" class="bg-gray-100 hover:bg-gray-200 text-gray-700 px-4 py-2 rounded-lg transition-colors duration-300 flex items-center">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
                        </svg>
                        Logout
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- Header -->
        <div class="text-center mb-12 fade-in">
            <div class="w-20 h-20 bg-gradient-to-r from-[#0C7A43] to-[#1E3A8A] rounded-full flex items-center justify-center mx-auto mb-6 shadow-lg">
                <svg class="w-10 h-10 text-white" fill="currentColor" viewBox="0 0 24 24">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335 .157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893c0-3.189-1.248-6.189-3.515-8.464"/>
                </svg>
            </div>
            <h1 class="text-4xl font-bold text-[#1E3A8A] mb-4">Connect WhatsApp Business</h1>
            <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                One-click OAuth integration to automatically setup your WhatsApp Business API
            </p>
        </div>

        <!-- Alert Messages -->
        <div id="message" class="hidden p-4 rounded-lg mb-6 fade-in"></div>

        <!-- Auto Redirect Check -->
        <div id="redirectCheck" class="text-center py-12">
            <div class="spinner mb-4"></div>
            <p class="text-gray-600">Checking WhatsApp connection status...</p>
        </div>

        <!-- Progress Steps -->
        <div class="flex justify-between items-center mb-12 relative max-w-2xl mx-auto">
            <div class="absolute top-4 left-0 right-0 h-1 bg-gray-200 -z-10"></div>
            
            <div class="step text-center relative z-10 flex-1">
                <div class="step-number w-10 h-10 rounded-full bg-[#0C7A43] text-white flex items-center justify-center mx-auto mb-2 font-bold bounce-in">1</div>
                <div class="text-sm font-medium text-[#0C7A43]">OAuth Login</div>
            </div>
            
            <div class="step text-center relative z-10 flex-1">
                <div class="step-number w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mx-auto mb-2 font-bold">2</div>
                <div class="text-sm font-medium text-gray-600">Fetch Details</div>
            </div>
            
            <div class="step text-center relative z-10 flex-1">
                <div class="step-number w-10 h-10 rounded-full bg-gray-300 text-gray-600 flex items-center justify-center mx-auto mb-2 font-bold">3</div>
                <div class="text-sm font-medium text-gray-600">Ready</div>
            </div>
        </div>

        <!-- Step 1: OAuth Login -->
        <div id="step1Content" class="bg-white rounded-2xl shadow-xl p-8 mb-8 hidden fade-in">
            <div class="text-center mb-8">
                <h2 class="text-3xl font-bold text-[#1E3A8A] mb-4">Connect with Meta</h2>
                <p class="text-gray-600 text-lg">Securely connect your WhatsApp Business Account using Meta OAuth 2.0</p>
            </div>

            <!-- Benefits Card -->
            <div class="bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-xl p-6 mb-8">
                <h3 class="font-semibold text-blue-800 text-lg mb-4 flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                    What will be automatically configured:
                </h3>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
                    <div class="flex items-center text-blue-700">
                        <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        Long-lived Access Token
                    </div>
                    <div class="flex items-center text-blue-700">
                        <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        WhatsApp Business Account ID
                    </div>
                    <div class="flex items-center text-blue-700">
                        <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        Phone Number ID
                    </div>
                    <div class="flex items-center text-blue-700">
                        <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                        </svg>
                        Business Profile & User Info
                    </div>
                </div>
            </div>

            <!-- OAuth Button -->
            <div class="text-center">
                <button 
                    onclick="startOAuth()" 
                    class="bg-[#1877F2] hover:bg-[#166FE5] text-white font-bold py-4 px-8 rounded-xl flex items-center justify-center gap-4 transition-all duration-300 transform hover:scale-105 mx-auto shadow-lg pulse-glow"
                    id="oauthButton"
                >
                    <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24">
                        <path d="M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"/>
                    </svg>
                    <span class="text-lg">Connect with Meta</span>
                </button>
                
                <div class="mt-4 flex items-center justify-center text-gray-500 text-sm">
                    <svg class="w-4 h-4 mr-2 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z" clip-rule="evenodd"/>
                    </svg>
                    Secure OAuth 2.0 â€¢ No manual setup required
                </div>
            </div>
        </div>

        <!-- Step 2: Processing & Details -->
        <div id="step2Content" class="bg-white rounded-2xl shadow-xl p-8 mb-8 hidden fade-in">
            <h2 class="text-3xl font-bold text-[#1E3A8A] mb-6 text-center">Processing Connection</h2>
            
            <!-- Loading State -->
            <div id="loadingSection" class="text-center py-12">
                <div class="spinner mb-6"></div>
                <h3 class="text-xl font-semibold text-gray-700 mb-2">Completing OAuth authentication</h3>
                <p class="text-gray-500 mb-6">Please wait while we fetch your WhatsApp Business Account details</p>
                <div class="max-w-md mx-auto">
                    <div class="progress-bar rounded-full mb-2"></div>
                    <div class="flex justify-between text-xs text-gray-500">
                        <span>Starting...</span>
                        <span>Fetching data...</span>
                        <span>Almost done</span>
                    </div>
                </div>
            </div>

            <!-- Details State -->
            <div id="detailsSection" class="hidden">
                <div class="bg-green-50 border border-green-200 rounded-xl p-6 mb-8 bounce-in">
                    <div class="flex items-center justify-between">
                        <div class="flex items-center">
                            <svg class="w-8 h-8 text-green-500 mr-3" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            </svg>
                            <div>
                                <h3 class="font-semibold text-green-800 text-lg">OAuth Successful!</h3>
                                <p class="text-green-600">Your WhatsApp Business Account has been connected</p>
                            </div>
                        </div>
                        <span class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                            Connected
                        </span>
                    </div>
                </div>

                <!-- Details Grid -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <div class="space-y-6">
                        <div class="bg-gray-50 p-6 rounded-xl slide-in">
                            <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-[#0C7A43]" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M4 4a2 2 0 012-2h8a2 2 0 012 2v12a1 1 0 110 2h-3a1 1 0 01-1-1v-2a1 1 0 00-1-1H9a1 1 0 00-1 1v2a1 1 0 01-1 1H4a1 1 0 110-2V4zm3 1h2v2H7V5zm2 4H7v2h2V9zm2-4h2v2h-2V5zm2 4h-2v2h2V9z" clip-rule="evenodd"/>
                                </svg>
                                Business Information
                            </h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm text-gray-500">Business Name</label>
                                    <p id="businessName" class="font-medium text-gray-900">-</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-500">WABA ID</label>
                                    <p id="wabaId" class="font-mono text-sm text-gray-900 bg-white p-2 rounded border">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 rounded-xl slide-in">
                            <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-[#0C7A43]" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M7 2a2 2 0 00-2 2v12a2 2 0 002 2h6a2 2 0 002-2V4a2 2 0 00-2-2H7zm3 14a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd"/>
                                </svg>
                                Phone Details
                            </h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm text-gray-500">Phone Number ID</label>
                                    <p id="phoneId" class="font-mono text-sm text-gray-900 bg-white p-2 rounded border">-</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-500">Phone Number</label>
                                    <p id="phoneNumber" class="font-medium text-gray-900">-</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="bg-gray-50 p-6 rounded-xl slide-in">
                            <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-[#0C7A43]" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"/>
                                </svg>
                                Account Information
                            </h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm text-gray-500">User Name</label>
                                    <p id="userName" class="font-medium text-gray-900">-</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-500">User Email</label>
                                    <p id="userEmailDisplay" class="font-medium text-gray-900">-</p>
                                </div>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-6 rounded-xl slide-in">
                            <h4 class="font-semibold text-gray-700 mb-3 flex items-center">
                                <svg class="w-5 h-5 mr-2 text-[#0C7A43]" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"/>
                                </svg>
                                Token Information
                            </h4>
                            <div class="space-y-3">
                                <div>
                                    <label class="text-sm text-gray-500">Token Expires</label>
                                    <p id="tokenExpiry" class="font-medium text-gray-900">-</p>
                                </div>
                                <div>
                                    <label class="text-sm text-gray-500">Token Type</label>
                                    <p class="font-medium text-gray-900">Long-lived (60 days)</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex gap-4 justify-center pt-6 border-t">
                    <button onclick="showStep(1)" class="px-8 py-3 border-2 border-[#0C7A43] text-[#0C7A43] rounded-xl hover:bg-[#0C7A43] hover:text-white transition-all duration-300 font-semibold">
                        Back
                    </button>
                    <button onclick="saveToFirebase()" class="px-8 py-3 bg-[#0C7A43] text-white rounded-xl hover:bg-[#085C34] transition-all duration-300 font-semibold flex items-center gap-2" id="saveButton">
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                        </svg>
                        Complete Setup
                    </button>
                </div>
            </div>
        </div>

        <!-- Step 3: Connected & Test Message -->
        <div id="step3Content" class="bg-white rounded-2xl shadow-xl p-8 mb-8 hidden fade-in">
            <div class="text-center py-8">
                <div class="w-24 h-24 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-6 bounce-in">
                    <svg class="w-12 h-12 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                    </svg>
                </div>
                <h2 class="text-4xl font-bold text-[#0C7A43] mb-4">Connected Successfully! ðŸŽ‰</h2>
                <p class="text-xl text-gray-600 mb-8 max-w-2xl mx-auto">
                    Your WhatsApp Business Account is now connected and ready to send messages.
                </p>
            </div>

            <!-- Test Message Section -->
            <div class="bg-gradient-to-r from-blue-50 to-green-50 border border-blue-200 rounded-xl p-6 mb-8">
                <h3 class="text-xl font-semibold text-blue-800 mb-4 flex items-center">
                    <svg class="w-6 h-6 mr-2" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 5v8a2 2 0 01-2 2h-5l-5 4v-4H4a2 2 0 01-2-2V5a2 2 0 012-2h12a2 2 0 012 2zM7 8H5v2h2V8zm2 0h2v2H9V8zm6 0h-2v2h2V8z" clip-rule="evenodd"/>
                    </svg>
                    Send Test Message
                </h3>
                <p class="text-blue-700 mb-4">Test your WhatsApp integration by sending a real message</p>
                
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Phone Number</label>
                        <input 
                            type="tel" 
                            id="testPhoneNumber" 
                            placeholder="+1234567890" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0C7A43] focus:border-transparent transition-all duration-300"
                        >
                        <p class="text-sm text-gray-500 mt-1">Include country code (e.g., +1 for US, +91 for India)</p>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Message</label>
                        <textarea 
                            id="testMessage" 
                            placeholder="Hello! This is a test message from Tap2Send." 
                            rows="3"
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-[#0C7A43] focus:border-transparent transition-all duration-300"
                        ></textarea>
                    </div>
                    <button 
                        onclick="sendTestMessage()" 
                        class="w-full bg-[#0C7A43] hover:bg-[#085C34] text-white font-semibold py-3 px-6 rounded-lg transition-all duration-300 flex items-center justify-center gap-2 transform hover:scale-105"
                        id="sendTestButton"
                    >
                        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M10.293 3.293a1 1 0 011.414 0l6 6a1 1 0 010 1.414l-6 6a1 1 0 01-1.414-1.414L14.586 11H3a1 1 0 110-2h11.586l-4.293-4.293a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                        Send Test Message
                    </button>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <a href="dashboard.html" class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-6 rounded-xl text-center hover:from-blue-600 hover:to-blue-700 transition-all duration-300 transform hover:scale-105 shadow-lg group">
                    <div class="text-2xl mb-3 group-hover:scale-110 transition-transform">ðŸ“Š</div>
                    <h3 class="font-semibold text-lg mb-2">Go to Dashboard</h3>
                    <p class="text-blue-100 text-sm">View analytics and manage your account</p>
                </a>
                <a href="campaigns.html" class="bg-gradient-to-r from-green-500 to-green-600 text-white p-6 rounded-xl text-center hover:from-green-600 hover:to-green-700 transition-all duration-300 transform hover:scale-105 shadow-lg group">
                    <div class="text-2xl mb-3 group-hover:scale-110 transition-transform">ðŸ“¨</div>
                    <h3 class="font-semibold text-lg mb-2">Create Campaign</h3>
                    <p class="text-green-100 text-sm">Send bulk messages to your contacts</p>
                </a>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-8 mt-12">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <div class="text-2xl font-bold text-[#0C7A43] mb-4">Tap2Send</div>
            <p class="text-gray-400 mb-4">Professional WhatsApp Business API Integration Platform</p>
            <div class="flex justify-center space-x-6 text-sm text-gray-400">
                <a href="#privacy" class="hover:text-white transition-colors">Privacy Policy</a>
                <a href="#terms" class="hover:text-white transition-colors">Terms of Service</a>
                <a href="#support" class="hover:text-white transition-colors">Support</a>
                <a href="#docs" class="hover:text-white transition-colors">Documentation</a>
            </div>
        </div>
    </footer>

    <script>
// -------------------------------
// FIREBASE CONFIG - YOUR LIVE CONFIG
// -------------------------------
const firebaseConfig = {
    apiKey: "AIzaSyDQMbfvjHV-1I3UEHt3asuEBNOO2Qh3RFA",
    authDomain: "tap2send-8e72d.firebaseapp.com",
    projectId: "tap2send-8e72d",
    storageBucket: "tap2send-8e72d.firebasestorage.app",
    messagingSenderId: "572191430506",
    appId: "1:572191430506:web:3100a351c4be63fbf6b713"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const auth = firebase.auth();

let currentUser = null;

// -------------------------------
// AUTH STATE MANAGEMENT
// -------------------------------
auth.onAuthStateChanged((user) => {
    if (!user) {
        window.location.href = 'auth.html';
    } else {
        currentUser = user;
        document.getElementById('userEmail').textContent = user.email;
        checkExistingConnection();
    }
});

// -------------------------------
// AUTO-REDIRECT IF ALREADY CONNECTED
// -------------------------------
async function checkExistingConnection() {
    try {
        const doc = await db.collection('whatsappAccounts').doc(currentUser.uid).get();
        
        if (doc.exists && doc.data().token) {
            // User is already connected - redirect to dashboard
            window.location.href = 'dashboard.html';
            return;
        }
        
        // User not connected - show connect screen
        document.getElementById('redirectCheck').classList.add('hidden');
        showStep(1);
        
    } catch (error) {
        console.error('Error checking connection:', error);
        document.getElementById('redirectCheck').classList.add('hidden');
        showStep(1);
    }
}

// -------------------------------
// SHOW MESSAGE
// -------------------------------
function showMessage(text, type="success") {
    const msg = document.getElementById("message");
    msg.classList.remove("hidden");
    msg.classList.remove("bg-red-100", "bg-green-100", "text-red-700", "text-green-700");

    if(type === "error") {
        msg.classList.add("bg-red-100", "text-red-700");
    } else {
        msg.classList.add("bg-green-100", "text-green-700");
    }

    msg.innerText = text;
    setTimeout(()=> msg.classList.add("hidden"), 4000);
}

// -------------------------------
// STEP SWITCHER
// -------------------------------
function showStep(step) {
    document.getElementById("step1Content").classList.add("hidden");
    document.getElementById("step2Content").classList.add("hidden");
    document.getElementById("step3Content").classList.add("hidden");

    document.getElementById("step" + step + "Content").classList.remove("hidden");
}

// -------------------------------
// START OAUTH
// -------------------------------
function startOAuth() {
    const redirectUrl = window.location.origin + "/connect.html";
    const appId = "YOUR_META_APP_ID"; // Replace with your actual Meta App ID

    const url =
        `https://www.facebook.com/v19.0/dialog/oauth?client_id=${appId}`+
        `&redirect_uri=${encodeURIComponent(redirectUrl)}`+
        `&scope=whatsapp_business_management,whatsapp_business_messaging,business_management,email,public_profile`;

    window.location.href = url;
}

// -------------------------------
// GET URL PARAM
// -------------------------------
function getParam(p) {
    return new URLSearchParams(window.location.search).get(p);
}

// -------------------------------
// AUTO CHECK ON PAGE LOAD
// -------------------------------
window.onload = async () => {
    const code = getParam("code");

    // 1. USER NOT CONNECTED YET â†’ SHOW STEP 1
    if(!code) {
        document.getElementById("redirectCheck").classList.add("hidden");
        showStep(1);
        return;
    }

    // 2. USER RETURNED FROM META â†’ PROCESS
    showStep(2);

    try {
        const accessToken = await exchangeCode(code);
        const details = await fetchWhatsAppDetails(accessToken);

        fillDetails(details);
        window.whatsappInfo = details;
        document.getElementById("loadingSection").classList.add("hidden");
        document.getElementById("detailsSection").classList.remove("hidden");

    } catch(err) {
        showMessage("Error fetching data: " + err.message, "error");
        showStep(1);
    }
};

// -------------------------------
// EXCHANGE CODE â†’ LONG LIVED TOKEN (YOUR SERVER REQUIRED)
// -------------------------------
async function exchangeCode(code) {
    // For demo purposes - in production, you need a server endpoint
    // Replace this with your actual server endpoint
    showMessage("Note: You need to implement server-side token exchange", "error");
    throw new Error("Server endpoint required for token exchange");
    
    // Uncomment and use this when you have your server ready:
    /*
    const res = await fetch("https://YOUR-SERVER.com/exchange-token?code=" + code);
    const data = await res.json();

    if(!data.access_token) throw new Error("Token exchange failed");
    return data.access_token;
    */
}

// -------------------------------
// FETCH WHATSAPP DETAILS
// -------------------------------
async function fetchWhatsAppDetails(token) {
    // GET USER INFO
    const userRes = await fetch(
        `https://graph.facebook.com/v19.0/me?fields=id,name,email&access_token=${token}`
    );
    const user = await userRes.json();

    // GET BUSINESS ACCOUNTS
    const wabaRes = await fetch(
        `https://graph.facebook.com/v19.0/${user.id}/owned_whatsapp_business_accounts?access_token=${token}`
    );
    const wabaData = await wabaRes.json();
    
    if (!wabaData.data || wabaData.data.length === 0) {
        throw new Error("No WhatsApp Business Accounts found");
    }
    
    const wabaId = wabaData.data[0].id;

    // GET PHONE NUMBERS
    const phoneRes = await fetch(
        `https://graph.facebook.com/v19.0/${wabaId}/phone_numbers?access_token=${token}`
    );
    const phoneData = await phoneRes.json();
    
    if (!phoneData.data || phoneData.data.length === 0) {
        throw new Error("No phone numbers found for this WhatsApp Business Account");
    }
    
    const phone = phoneData.data[0];

    return {
        token,
        userName: user.name,
        userEmail: user.email,
        wabaId,
        businessName: "WhatsApp Business",
        phoneId: phone.id,
        phoneNumber: phone.display_phone_number,
        connected: true,
        connected_at: new Date().toISOString()
    };
}

// -------------------------------
// FILL UI DETAILS
// -------------------------------
function fillDetails(d) {
    document.getElementById("businessName").innerText = d.businessName;
    document.getElementById("wabaId").innerText = d.wabaId;
    document.getElementById("phoneId").innerText = d.phoneId;
    document.getElementById("phoneNumber").innerText = d.phoneNumber;
    document.getElementById("userName").innerText = d.userName;
    document.getElementById("userEmailDisplay").innerText = d.userEmail;
    document.getElementById("tokenExpiry").innerText = "60 Days";
}

// -------------------------------
// SAVE TO FIREBASE
// -------------------------------
async function saveToFirebase() {
    const user = auth.currentUser;
    if(!user) return showMessage("Not logged in", "error");

    try {
        await db.collection("whatsappAccounts").doc(user.uid).set({
            ...window.whatsappInfo,
            date: new Date()
        });

        showMessage("Setup Completed Successfully!");
        setTimeout(()=> showStep(3), 1000);
    } catch (error) {
        showMessage("Error saving to Firebase: " + error.message, "error");
    }
}

// -------------------------------
// SEND TEST MESSAGE
// -------------------------------
async function sendTestMessage() {
    const phoneNumber = document.getElementById("testPhoneNumber").value.trim();
    const message = document.getElementById("testMessage").value.trim();
    const sendButton = document.getElementById("sendTestButton");

    if (!phoneNumber || !message) {
        showMessage("Please enter both phone number and message", "error");
        return;
    }

    if (!phoneNumber.startsWith('+')) {
        showMessage("Please include country code (e.g., +1 for US, +91 for India)", "error");
        return;
    }

    const originalText = sendButton.innerHTML;
    sendButton.innerHTML = '<div class="spinner w-5 h-5"></div> Sending...';
    sendButton.disabled = true;

    try {
        const doc = await db.collection('whatsappAccounts').doc(currentUser.uid).get();
        
        if (!doc.exists) {
            throw new Error('WhatsApp connection not found');
        }

        const whatsappData = doc.data();
        const phoneId = whatsappData.phoneId;
        const accessToken = whatsappData.token;

        // Send message using WhatsApp Business API
        const response = await fetch(`https://graph.facebook.com/v19.0/${phoneId}/messages`, {
            method: 'POST',
            headers: {
                'Authorization': `Bearer ${accessToken}`,
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({
                messaging_product: 'whatsapp',
                to: phoneNumber,
                type: 'text',
                text: {
                    body: message
                }
            })
        });

        const result = await response.json();

        if (response.ok) {
            showMessage('Test message sent successfully!', 'success');
            document.getElementById('testPhoneNumber').value = '';
            document.getElementById('testMessage').value = '';
        } else {
            throw new Error(result.error?.message || 'Failed to send message');
        }

    } catch (error) {
        showMessage('Failed to send message: ' + error.message, 'error');
    } finally {
        sendButton.innerHTML = originalText;
        sendButton.disabled = false;
    }
}

// -------------------------------
// LOGOUT
// -------------------------------
function logout() {
    auth.signOut().then(()=> window.location.href = "index.html");
}
</script>
</body>
</html>
